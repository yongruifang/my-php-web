<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台</title>
    <!-- 引入 layui.css -->
    <link rel="stylesheet" href="//unpkg.com/layui@2.6.8/dist/css/layui.css">
    <script src="public/jquery.min.js"></script>
</head>
<body>
    <h2>customer表</h2>
    <!-- 工具集 -->
    <div class="customer-btn-box">
        <span class="f1">
            <a class="layui-btn btn-add btn-default" id="customer-add">添加</a>
        </span>
    </div>
    <table id="customer" lay-filter="demo">
        <thead>
            <tr>
                <th lay-data="{field:'id',width:100,sort:true}">ID</th>
                <th lay-data="{field:'fitness_no',width:80,sort:true}">fit</th>
                <th lay-data="{field:'exercise_no',width:80,sort:true}">频率</th>
                <th lay-data="{field:'tid',width:100,sort:true}">教练</th>
                <th lay-data="{field:'birth_date',width:120}">生日</th>
                <th lay-data="{field:'credit_card',width:80,sort:true}">信用卡</th>
                <th lay-data="{field:'health_no',width:80}">health</th>
                <th lay-data="{field:'level_no',width:80}">level</th>
                <th lay-data="{field:'opt_customer',width:150,toolbar:'#barDemo'}">操作</th>                    
            </tr>
        </thead>
        <tbody>
            <?php
            foreach($customers as $customer){
            ?>
            <tr>
                <td><?=$customer['id']?></td>
                <td><?=$customer['fitness_no']?></td>
                <td><?=$customer['exercise_no']?></td>
                <td><?=$customer['tid']?></td>
                <td><?=$customer['birth_date']?></td>
                <td><?=$customer['credit_card']?></td>
                <td><?=$customer['health_no']?></td>
                <td><?=$customer['level_no']?></td>
                <td></td> 
            </tr>
            <?php }?>
        </tbody>
    </table>
    <h2>fitness表</h2>
    <!-- 工具集 -->
    <div class="customer-btn-box">
        <span class="f1">
            <a class="layui-btn btn-add btn-default" id="fitness-add">添加</a>
        </span>
    </div>
    <table id="fitness" lay-filter="demo">
        <thead>
            <tr>
                <th lay-data="{field:'no',width:80,sort:true}">no</th>
                <th lay-data="{field:'text',width:150}">text</th>
                <th lay-data="{field:'opt_fitness',width:150,toolbar:'#barDemo'}">操作</th>                    
            </tr>
        </thead>
        <tbody>
            <?php
            foreach($fitnesss as $fitness){
            ?>
            <tr>
                <td><?=$fitness['no']?></td>
                <td><?=$fitness['text']?></td>
                <td></td> 
            </tr>
            <?php }?>
        </tbody>
    </table>
   <h2>exercise表</h2>
   <!-- 工具集 -->
   <div class="customer-btn-box">
    <span class="f1">
        <a class="layui-btn btn-add btn-default" id="exercise-add">添加</a>
    </span>
</div>
   <table id="exercise" lay-filter="demo">
    <thead>
        <tr>
            <th lay-data="{field:'no',width:80,sort:true}">no</th>
            <th lay-data="{field:'text',width:150}">text</th>
            <th lay-data="{field:'opt_exercise',width:150,toolbar:'#barDemo'}">操作</th>                    
        </tr>
    </thead>
    <tbody>
    <?php
    foreach($exercises as $exercise){
    ?>
    <tr>
        <td><?=$exercise['no']?></td>
        <td><?=$exercise['text']?></td>
        <td></td> 
    </tr>
    <?php }?>
    </tbody>
    </table>
    <h2>health表</h2>
    <!-- 工具集 -->
    <div class="customer-btn-box">
        <span class="f1">
            <a class="layui-btn btn-add btn-default" id="health-add">添加</a>
        </span>
    </div>
    <table id="health" lay-filter="demo">
    <thead>
        <tr>
            <th lay-data="{field:'no',width:80,sort:true}">no</th>
            <th lay-data="{field:'text',width:150,sort:true}">text</th>
            <th lay-data="{field:'opt_health',width:150,toolbar:'#barDemo'}">操作</th>                    
        </tr>
    </thead>
    <tbody>
    <?php
    foreach($healths as $health){
    ?>
    <tr>
        <td><?=$health['no']?></td>
        <td><?=$health['text']?></td>
        <td></td> 
    </tr>
    <?php }?>
    </tbody>
    </table>
    <h2>level表</h2>
    <!-- 工具集 -->
    <div class="customer-btn-box">
        <span class="f1">
            <a class="layui-btn btn-add btn-default" id="level-add">添加</a>
        </span>
    </div>
    <table id="level" lay-filter="demo">
    <thead>
        <tr>
            <th lay-data="{field:'no',width:80,sort:true}">no</th>
            <th lay-data="{field:'text',width:120,sort:true}">text</th>
            <th lay-data="{field:'fee',width:120,sort:true}">fee</th>
            <th lay-data="{field:'opt_level',width:150,toolbar:'#barDemo'}">操作</th>                    
        </tr>
    </thead>
    <tbody>
    <?php
    foreach($levels as $level){
    ?>
    <tr>
        <td><?=$level['no']?></td>
        <td><?=$level['text']?></td>
        <td><?=$level['fee']?></td>
        <td></td>
    </tr>
    <?php }?>
    </tbody>
    </table>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script src="//unpkg.com/layui@2.6.8/dist/layui.js"></script>
<script>
    layui.use(['table'],function(){
        var table=layui.table;
        table.init('demo',{
            minWidth:50
            ,page:true
        });
        //监听customer表
        table.on('tool(demo)', function(obj){
            var data = obj.data //获得当前行数据
              ,layEvent = obj.event;
            if(layEvent === 'del'){
                layer.confirm('真的删除行么', function(index){
                    if('opt_customer' in data){
                        // alert(data['id']);
                        location.href="?p=admin&c=customer&a=index&id="+data['id']+"&exec=customer_delete_&token="+"<?=TOKEN?>";
                        layer.msg('删除中');
                    }else if('opt_fitness' in data){
                        // alert(data['no']);
                        location.href="?p=admin&c=customer&a=index&no="+data['no']+"&exec=fitness_delete_&token="+"<?=TOKEN?>";
                        layer.msg('删除中');
                    }else if('opt_exercise' in data){
                        // alert(data['no']);
                        location.href="?p=admin&c=customer&a=index&no="+data['no']+"&exec=exercise_delete_&token="+"<?=TOKEN?>";
                        layer.msg('删除中');
                    }else if('opt_health' in data){
                        // alert(data['no']);
                        location.href="?p=admin&c=customer&a=index&no="+data['no']+"&exec=health_delete_&token="+"<?=TOKEN?>";
                        layer.msg('删除中');
                    }else if('opt_level' in data){
                        location.href="?p=admin&c=customer&a=index&no="+data['no']+"&exec=level_delete_&token="+"<?=TOKEN?>";
                        layer.msg('删除成功');
                    }
                    layer.close(index);
                });
            } else if(layEvent === 'edit'){
                var url = '';
                var obj = '';
                if('opt_customer' in data){
                    url = 'edit_customer.html';
                    opt = 'customer_edit_';
                }else if('opt_fitness' in data){
                    url = 'edit_fitness.html';
                    opt = 'fitness_edit_';
                }else if('opt_exercise' in data){
                    url = 'edit_exercise.html';
                    opt = 'exercise_edit_';
                }else if('opt_health' in data){
                    url = 'edit_health.html';
                    opt = 'health_edit_';
                }else if('opt_level' in data){
                    url = 'edit_level.html';
                    opt = 'level_edit_';
                }
                var prefix = './public/admin/';
                url = prefix + url;
                layer.open({
                    type:2, //iframe 解析content
                    maxmin:true, // 最大最小化
                    content:url,
                    title: '<li id="icon" class="layui-icon layui-icon-release layui-anim layui-anim-scaleSpring" ' +'style="font-size: 30px; color: #009688;" data-anim="layui-anim-scaleSpring"></li> 编辑 ',
                    area: ['470px', '600px'],//area: [window.screen.width / 2 + 'px', window.screen.height / 2 + 'px'], //宽高
                    //层弹出后的成功回调方法, layero前层DOM， index为当前层索引
                    success: function(layero,index){
                        //1. 获取当前层的子窗口的body
                        var body = layer.getChildFrame('body',index);//建立父子联系
                        //2. 获取子窗口对象
                        var iframe = window['layui-layer-iframe' + index];
                        //3. 传递参数
                        var inputList = body.find('input');
                        var json=JSON.parse(JSON.stringify(data));
                        for(let d in json){
                            body.find('input[name="'+d+'"][type="text"],[type="hidden"]').val(json[d])
                        } 
                        //4.可通过iframe.child向iframe层传递额外参数token
                        // var token="<?=TOKEN?>";
                        // iframe.child(token);
                        var objs1 = {
                            "token" : "<?=TOKEN?>",
                            "opt" : opt
                        };
                        iframe.child(objs1);
                    },
                    end:function(){
                        //刷新当前界面，但是好慢
                        //location.reload(true);
                        //这两个的速度快一点
                        location.reload(false);
                        //history.go(0);
                        layer.msg('保存成功');
                    }
                });
            }
        });
        $('#customer-add').on('click',function(){
            layer.open({
                type:2, 
                maxmin:true,
                content:"./public/admin/edit_customer.html",
                title: '<li id="icon" class="layui-icon layui-icon-release layui-anim layui-anim-scaleSpring" ' +'style="font-size: 30px; color: #009688;" data-anim="layui-anim-scaleSpring"></li> 编辑 ',
                area: ['470px', '600px'],//area: [window.screen.width / 2 + 'px', window.screen.height / 2 + 'px'], //宽高
                //层弹出后的成功回调方法, layero前层DOM， index为当前层索引
                success: function(layero,index){
                    //1. 获取子窗口对象
                    var iframe = window['layui-layer-iframe' + index];
                    //2.可通过iframe.child向iframe层传递额外参数token
                    var objs1 = {
                        "token" : "<?=TOKEN?>",
                        "opt" : "customer_add_"
                    };
                    iframe.child(objs1);
                },
                end:function(){
                    location.reload(false);
                    layer.msg('添加成功');
                }
            });
        });
        $('#fitness-add').on('click',function(){
            layer.open({
                type:2, 
                maxmin:true,
                content:"./public/admin/edit_fitness.html",
                title: '<li id="icon" class="layui-icon layui-icon-release layui-anim layui-anim-scaleSpring" ' +'style="font-size: 30px; color: #009688;" data-anim="layui-anim-scaleSpring"></li> 编辑 ',
                area: ['470px', '600px'],//area: [window.screen.width / 2 + 'px', window.screen.height / 2 + 'px'], //宽高
                //层弹出后的成功回调方法, layero前层DOM， index为当前层索引
                success: function(layero,index){
                    //1. 获取子窗口对象
                    var iframe = window['layui-layer-iframe' + index];
                    //2.可通过iframe.child向iframe层传递额外参数token
                    var objs1 = {
                        "token" : "<?=TOKEN?>",
                        "opt" : "fitness_add_"
                    };
                    iframe.child(objs1);
                },
                end:function(){
                    location.reload(false);
                    layer.msg('添加成功');
                }
            });
        });
        $('#exercise-add').on('click',function(){
            layer.open({
                type:2, 
                maxmin:true,
                content:"./public/admin/edit_exercise.html",
                title: '<li id="icon" class="layui-icon layui-icon-release layui-anim layui-anim-scaleSpring" ' +'style="font-size: 30px; color: #009688;" data-anim="layui-anim-scaleSpring"></li> 编辑 ',
                area: ['470px', '600px'],//area: [window.screen.width / 2 + 'px', window.screen.height / 2 + 'px'], //宽高
                //层弹出后的成功回调方法, layero前层DOM， index为当前层索引
                success: function(layero,index){
                    //1. 获取子窗口对象
                    var iframe = window['layui-layer-iframe' + index];
                    //2.可通过iframe.child向iframe层传递额外参数token
                    var objs1 = {
                        "token" : "<?=TOKEN?>",
                        "opt" : "exercise_add_"
                    };
                    iframe.child(objs1);
                },
                end:function(){
                    location.reload(false);
                    layer.msg('添加成功');
                }
            });
        });
        $('#health-add').on('click',function(){
            layer.open({
                type:2, 
                maxmin:true,
                content:"./public/admin/edit_health.html",
                title: '<li id="icon" class="layui-icon layui-icon-release layui-anim layui-anim-scaleSpring" ' +'style="font-size: 30px; color: #009688;" data-anim="layui-anim-scaleSpring"></li> 编辑 ',
                area: ['470px', '600px'],//area: [window.screen.width / 2 + 'px', window.screen.height / 2 + 'px'], //宽高
                //层弹出后的成功回调方法, layero前层DOM， index为当前层索引
                success: function(layero,index){
                    //1. 获取子窗口对象
                    var iframe = window['layui-layer-iframe' + index];
                    //2.可通过iframe.child向iframe层传递额外参数token
                    var objs1 = {
                        "token" : "<?=TOKEN?>",
                        "opt" : "health_add_"
                    };
                    iframe.child(objs1);
                },
                end:function(){
                    location.reload(false);
                    layer.msg('添加成功');
                }
            });
        });
        $('#level-add').on('click',function(){
            layer.open({
                type:2, 
                maxmin:true,
                content:"./public/admin/edit_level.html",
                title: '<li id="icon" class="layui-icon layui-icon-release layui-anim layui-anim-scaleSpring" ' +'style="font-size: 30px; color: #009688;" data-anim="layui-anim-scaleSpring"></li> 编辑 ',
                area: ['470px', '600px'],//area: [window.screen.width / 2 + 'px', window.screen.height / 2 + 'px'], //宽高
                //层弹出后的成功回调方法, layero前层DOM， index为当前层索引
                success: function(layero,index){
                    //1. 获取子窗口对象
                    var iframe = window['layui-layer-iframe' + index];
                    //2.可通过iframe.child向iframe层传递额外参数token
                    var objs1 = {
                        "token" : "<?=TOKEN?>",
                        "opt" : "level_add_"
                    };
                    iframe.child(objs1);
                },
                end:function(){
                    location.reload(false);
                    layer.msg('添加成功');
                }
            });
        });
    });
</script>
</body>
</html>

